# Docker 服务安排明细

## DNS 服务器

2台：

分别为：10.10.20.206 和10.10.20.207

### 如何使用

需要修改本机的/etc/resolv.conf 指向这2台机器地址，例如：
> 这是我的一台虚拟机
<pre>

[root@linux-node2 ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
#nameserver 192.168.56.2
nameserver 10.10.20.206
nameserver 10.10.20.207

</pre>

测试，通过ping 域名看是否解析

<pre>
[root@linux-node2 ~]# ping registry.cloud.jyall.com
PING registry.cloud.jyall.com (10.10.20.204) 56(84) bytes of data.
64 bytes from 10.10.20.204: icmp_seq=1 ttl=128 time=2.80 ms
64 bytes from 10.10.20.204: icmp_seq=2 ttl=128 time=1.01 ms

</pre>

> 很明显，我做了10.10.20.204 跟私有仓库域名解析registry.cloud.jyall.com

我来看看我的解析文件

<pre>

[root@node3-docker20-206 etc]# cat /var/named/cloud.jyall.com.zone 
$ORIGIN cloud.jyall.com. 
$TTL 86400
@      IN  SOA         dns1.cloud.jyall.com.  xie.cloud.jyall.com.  (
                          2015040101
                          21600
                          3600
                          604800
                          86400 )
@      IN  NS          dns1.cloud.jyall.com.
         IN  NS          dns2.cloud.jyall.com.
dns1   IN  A            10.10.20.206
dns2   IN  A            10.10.20.207

www     IN  CNAME      cloud.jyall.com.
ftp        IN  CNAME     servs.cloud.jyall.com.
servs    IN   A              10.10.20.206

forum   IN A              10.10.30.100
travel    IN A              10.10.30.101
            IN A              10.10.30.102

registry IN  A		10.10.20.204
yum        IN A            10.10.20.190
wiki		IN A  		10.10.20.207


</pre>

测试ping 

<pre>

[root@node3-docker20-206 etc]# ping wiki.cloud.jyall.com
PING wiki.cloud.jyall.com (10.10.20.207) 56(84) bytes of data.
64 bytes from node4-docker20-207 (10.10.20.207): icmp_seq=1 ttl=64 time=0.379 ms
64 bytes from node4-docker20-207 (10.10.20.207): icmp_seq=2 ttl=64 time=0.365 ms

</pre>



## 私有仓库的使用

###私有仓库地址

在服务器10.10.20.204上，域名为registry.cloud.jyall.com
> 使用之前需要添加/etc/resolv.conf 文件为DNS服务器地址

我挂载目录为宿主机：/docker-data/registry  容器内： /tmp/registry


其他宿主机，如果想使用私有仓库，需要修改两个地方：

* 添加 nameserver  到/etc/resolv.conf

<pre> 

 >/etc/resolv.conf && echo "nameserver 10.10.20.206
 " >>/etc/resolv.conf&& echo "nameserver 10.10.20.207">>/etc/resolv.conf

</pre>

* 修改docker 配置文件

<pre>
OPTIONS='--selinux-enabled  --insecure-registry registry.cloud.jyall.com  --insecure-registry 10.10.20.204 -H tcp://0.0.0.0:5555 -H unix://var/run/docker.sock'

systemctl restart docker

</pre>


配置完了以后，可以先测试能不能ping通这个域名跟IP的解析

<pre>
[root@node3-docker20-206 ~]# ping registry.cloud.jyall.com
PING registry.cloud.jyall.com (10.10.20.204) 56(84) bytes of data.
64 bytes from node1-docker20-204 (10.10.20.204): icmp_seq=1 ttl=64 time=0.217 ms
64 bytes from node1-docker20-204 (10.10.20.204): icmp_seq=2 ttl=64 time=0.243 ms

</pre>

然后我们就可以pull镜像了，测试如下：

<pre>

[root@node3-docker20-206 ~]# docker pull  registry.cloud.jyall.com/java8:1.0
1d3fdf080282: Pulling dependent layers 
1d3fdf080282: Pulling image (1.0) from registry.cloud.jyall.com/java8 
47d44cb6f252: Download complete 
8aa7f4a1dd13: Download complete 
e0f5867add13: Download complete 
eeb3a076a0be: Download complete 
0c1c70401d31: Download complete 
96265ff8a496: Download complete 
6a560a5bcf42: Download complete 
545a893089eb: Download complete 
c7f52651e1a0: Download complete 
04542733384c: Download complete 
bdf761ecafd2: Download complete 

</pre>


###如何去查看我有哪些镜像

使用西面命令查看：

<pre>

curl -s registry.cloud.jyall.com/v1/search|python -mjson.tool

</pre>

或者呢，你可以写个文本。


